\section{Overview of the Up-Scaling Methodology}
The goal of the up-scaling methodology is to identify the parameters of a continuum constitutive model (macroscale model) that best emulates the response of the DEM REV (microscale model). Let the displacement, strain and stress of the DEM REV (microscale) model be denoted by $\mathbf{u}^m$, $\boldsymbol{\epsilon}}^m$, and $\boldsymbol{\sigma}}^m$, respectively. Let the homogenized (averaged) strain and stress of the DEM REV model be denoted by  $\left<\boldsymbol{\epsilon}}\right>$ and $\left<\boldsymbol{\sigma}}\right>$, respectively.  Finally, let the strain and stress from the continuum (Macroscale) constitutive model be denoted as $\boldsymbol{\epsilon}}^M$ and $\boldsymbol{\sigma}}^M$, respectively. The rate of macroscale stress, $\dot\boldsymbol{\sigma}}^M=\dot\boldsymbol{\sigma}}^M\left(\dot{\boldsymbol{\epsilon}}}^M, \boldsymbol{\phi},\mathbf{h}\right)$, is defined in terms of the rate of macroscale strain, $\dot{\boldsymbol{\epsilon}}}^M$, a set of material parameters $\boldsymbol{\phi}$ and a set of internal history variables $\mathbf{h}$.

The up-scaling methodology has five steps: 
\begin{enumerate}
    \item Identify the DEM RVE for the NFR.
	\item Exercise the DEM RVE using multiple load paths.
	\item Apply homogenization algorithms to DEM (microscale) results to determine the average stress-strain response of the RVE.
	\item Identify a continuum constitutive model suitable to capture the salient features of NFR mechanics.
	\item Run parameter estimation algorithms to minimize the difference between the continuum and homogenized DEM responses.
\end{enumerate}

\subsection*{Identify DEM RVE}
Homogenizing DEM simulations necessitates the existence and determination of the REV for that medium. Generally, the REV of a given domain can fundamentally be described as the smallest subdomain that is sufficiently large as to be statistically representative of the entire domain \citep{Kanit_2003, Gitman_2007}. This qualitative definition is insufficient to rigorously define an REV quantitatively, for the REV characterization is subjective with respect to what constitutes something to be “statistically representative”. As such, the assessment of the REV can be a contentious issue, fraught with ambiguity.

One can conceptualize an REV to be “statistically representative” in two primarily different ways \citep{Drugan_1996}. The classically cited means for characterizing an REV suggests that the micro-scale heterogeneities (e.g. fractures, voids, grains, etc.) should be statistically representative within the REV such that the REV should contain a sufficiently large sample of these heterogeneities. This characterization of the REV is potentially problematic when attempting to quantify the REV, such that the descriptions of these heterogeneities tend to be nominally qualitative, and at best, quasi-quantitative.

The alternative means of conceptualizing “statistically representative”, and arguably the more pragmatic way when considering numerical modeling, proposes that the constitutive response of the REV should be statistically representative of the domain. In other words, as one increases the size of a sample domain, the point at which the constitutive response within the domain becomes constant can be referred to as the REV. Unlike the other characterization, the constitutive response of a subdomain is quantifiable through resultant model properties and parameters. This interpretation the REV is used in this investigation and has been widely used in other numerical studies due to its quantifiability \citep{Kanit_2003, Gitman_2005, Gusev_1997, M_ller_2010}.

\subsection*{Exercise DEM RVE}
The DEM RVE is exercised for different load-paths in a way that is akin to conducting multiple laboratory tests on physical specimens to characterize the full range of material behaviour. Specifically, the mechanical response ($\boldsymbol{\epsilon}}^m$ and $\boldsymbol{\sigma}}^m$) of NFR depends upon the degree of confinement and so it is necessary to perform multiple virtual triaxial tests at different levels of confinement. 

\subsection*{Apply homogenization algorithms}
Output from the DEM simulation include the nodal displacements, $\mathbf{u}^m$, of the deformable blocks between the natural fractures and therefore the normal and tangential crack opening displacements, and the microscale stress-strain response: $\boldsymbol{\sigma}}^m$-$\boldsymbol{\epsilon}}^m$.  Using these quantities, the average stress-strain behaviour,  $\left<\boldsymbol{\sigma}}\right>$-$\left<\boldsymbol{\epsilon}}\right>$, of the DEM RVE is determined by homogenization, which is discussed in detail in Section 3.

\subsection*{continuum constitutive model}
In dealing with NFR, the behaviour of the rock mass is largely controlled by the reactivation and failure of existing natural fractures. As fractures grow, the integrity and stiffness of the rock mass decreases. From this perspective, a continuum description of a NFR can be well approximated using Continuum Damage Mechanics (CDM). CDM models capture the salient features of progressive failure and stiffness degradation without the need for an explicit representation of the fracture network. Here we adopted a Ducker-Prager model for the macroscale  $\boldsymbol{\sigma}}^M$-$\boldsymbol{\epsilon}}^M$ behaviour, where $\boldsymbol{\phi}$ is a vector of 11 parameters-2 elastic, 6 plastic, and 3 damage. This model is described in more detail in Section 4.

\subsection*{run parameter estimation algorithms}
In this step, the vector of material properties $\boldsymbol{\phi}$ which yields a macroscale $\boldsymbol{\sigma}}^M$-$\boldsymbol{\epsilon}}^M$ response which best approximates the average microscale $\left<\boldsymbol{\sigma}}\right>$-$\left<\boldsymbol{\epsilon}}\right>$ response of the RVE is determined using an iterative optimization algorithm. The optimization algorithm is discussed further in Section YYY.

\subsection{Software Implementation}
The upscaling framework that is presented here consists of four main software components (Figure \ref{fig:workflow}). In procedural order, the first software component involved is a DEM simulation package, which is used to directly model the NFR. The DEM software accepts as inputs the geometry of the DFN, the material properties of the rock and the natural fractures, and the load paths. The DEM software outputs the microscale displacement, $\mathbf{u}^m$, and stress-strain responses, $\boldsymbol{\sigma}}^m$-$\boldsymbol{\epsilon}}^m$, for each load path.  This microscale data is subsequently fed into the homogenization program to compute the average stress-strain response,$\left<\boldsymbol{\sigma}}\right>$-$\left<\boldsymbol{\epsilon}}\right>$,  for each load path. Next, the homogenized stress-strain data, $\left<\boldsymbol{\sigma}}\right>$-$\left<\boldsymbol{\epsilon}}\right>$, is used by the parameter estimation software as observation data (i.e., laboratory/field data). The parameter estimation program iteratively executes the CDM model for each load path using different parameter sets, while attempting minimize the error between the homogenized microscale and CDM stress-strain curves. Eventually, the algorithm converges to a near-optimal parameter set, $\boldsymbol{\phi}$, that can be viewed to be the best estimate of the NFR responses by the given continuum model. In our implementation, single element simulations in ABAQUS are performed where a prescribed strain-history is prescribed on the boundaries of the element for a given set of material parameters and the stress is obtained as the output.

Once an optimal parameter set for the CDM model has been identified, the newly established constitutive model can be used in Finite Element Method (FEM) models or with any other numerical or analytical simulation.


